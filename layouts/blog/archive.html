{{ define "secondary-navbar" }}
{{ partial "blog/navbar" . }}
{{ end }}

{{ define "main" }}
<div class="row">
    {{- $page := . -}}
    <div class="col-md-9">
        <!-- Search field -->
        <form>
            <div class="form-group">
                <input type="search" class="form-control" id="filter" autofocus
                       placeholder="{{ T `filter` }}" aria-label="{{ T `filter` }}">
            </div>
        </form>

        <!-- Post list -->
        <table class="blog-post-list" id="posts-table"><tbody>
        {{- $year := 0 -}}
        {{- $list :=  where .Site.RegularPages "Type" "post" -}}
        {{- $count := len $list -}}
        {{- range $idx, $post := $list -}}

        <!-- Year heading - if the year has changed   -->
        {{- if not (eq $year .Date.Year) -}}
        {{- $year = .Date.Year -}}
        <tr><th colspan="3">{{ $year }}</th></tr>
        {{- end -}}

        <!-- Output a post row -->
        <tr class="post-row">
            <td class="number">{{ sub $count $idx }}.</td>
            <td class="date">{{ partial "date" (dict "date" .Date "long" false) }}</td>
            <td>{{ .Render "lang-link" }}</td>
        </tr>
        {{ end }}
        </tbody></table>
    </div>

    <!-- Legend -->
    <div class="col-md-3 d-none d-md-block">
        <div class="sticky-top">
        <h4>{{ T "iAmLegend" }}</h4>
        <ul class="list-unstyled">
            {{- range .Site.Languages }}
            <li><span class="post_{{ .Lang }}"></span>&nbsp;{{ T "post" }} {{ T (print "postIn_" .Lang) }}</li>
            {{ end -}}
        </ul>
        </div>
    </div>
</div>
{{ end }}

{{ define "extra-scripts" }}
<script>
    $(document).ready(function () {

        var timer;
        var searchBox = $('#filter');

        /**
         * Remove search timer, if any.
         */
        function clearTimer() {
            if (timer !== undefined) {
                clearTimeout(timer);
                timer = undefined;
            }
        }

        /**
         * Perform search.
         */
        function doSearch() {
            var s = searchBox.val().toLowerCase();
            $('#posts-table tr').each(function () {
                var row = $(this);
                row.toggleClass('d-none', s !== '' && !row.text().toLowerCase().includes(s));
            });
        }

        // Add a search pattern change listener
        searchBox.on('keyup change paste', function () {
            clearTimer();
            timer = setTimeout(doSearch, 250);
        });

        // On pressing Enter or clearing the input, trigger search immediately
        searchBox.on('search', doSearch);
    });

</script>
{{ end }}

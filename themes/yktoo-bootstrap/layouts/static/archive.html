{{ define "secondary-navbar" }}
{{ partial "blog/navbar" . }}
{{ end }}

{{ define "main" }}
<!-- Legend -->
<div class="d-none d-lg-block float-right">
    <h4>{{ T "iAmLegend" }}</h4>
    <ul class="list-unstyled">
        {{- range .Site.Languages }}
        <li><span class="post_{{ .Lang }}"></span>&nbsp;{{ T "post" }} {{ T (print "postIn_" .Lang) }}</li>
        {{ end -}}
    </ul>
</div>

<!-- Post list -->
{{- $dateFormat := default "Jan 2, 2006" (index .Site.Params "short_date_format") -}}
<table class="blog-post-list"><tbody>
    {{- $year := 0 -}}
    {{- $list := where .Site.RegularPages "Type" "blog" -}}
    {{- $count := len $list -}}
    {{- range $idx, $post := $list -}}

        <!-- Year heading - if the year has changed   -->
        {{- if not (eq $year .Date.Year) -}}
            {{- $year = .Date.Year -}}
            <tr><th colspan="3">{{ $year }}</th></tr>
        {{- end -}}

        <!-- Compile a list of languages the current page is translated to -->
        {{- $pageLangs := slice .Lang -}}
        {{- range .Translations }}{{ $pageLangs = $pageLangs | append .Lang }}{{ end -}}

        <!-- Output a post row -->
        <tr>
            <td class="number">{{ sub $count $idx }}.</td>
            <td class="date"><time datetime="{{ .Date.Format `2006-01-02T15:04:05Z07:00` }}">{{ .Date.Format $dateFormat }}</time></td>
            <td><a href="{{ .Permalink }}">
                {{- range .Site.Languages }}<span class="post_{{ cond (in $pageLangs .Lang) .Lang `none` }}"></span>{{ end -}}&nbsp;
                {{- with .Params.group }}{{ . }} â€£ {{ end }}{{ .Title | markdownify | plainify | safeHTML -}}
            </a></td>
        </tr>
    {{ end }}
</tbody></table>
{{ end }}
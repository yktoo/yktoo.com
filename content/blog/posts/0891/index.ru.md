---
type: post
date: "2024-04-20T17:50:26+02:00"
title: "3.7.0 Armagh"
tags:
    - Comentario
    - веб
    - софт
    - разработка
    - релиз
    - Go
    - Angular
image: "https://res.cloudinary.com/yktoo/image/upload/v1713628168/blog/b3blrv7cunv6z9fykscg.jpg"
imageCredit: "Изображение: кибермозг."
series: comentario
software: comentario
---

Вышла новая версия [Comentario 3.7.0 Armagh](https://gitlab.com/comentario/comentario/-/releases/v3.7.0).

[Comentario](/software/comentario) — это быстрый и мощный свободный сервер комментариев для веб-страниц, написанный на {{< fl "Go" >}}.

{{< imgfig "https://res.cloudinary.com/yktoo/image/upload/v1713628168/blog/b3blrv7cunv6z9fykscg.jpg" >}}

## Что нового

Это первый релиз, изменяющий структуру базы данных, после [3.0.0](0880), поэтому в нём собрано немало новшеств.

<!--more-->

### Динамическая конфигурация уровня домена

Принцип [динамической конфигурации](https://docs.comentario.app/en/configuration/backend/dynamic/), ранее применявшийся ко всей системе, теперь распространяется и на настройки на уровне отдельного домена. Основное преимущество таких настроек в том, что они *динамические*:

* Их можно менять на ходу, и изменения начинают действовать сразу.
* Набор настроек легко менять, так как при этом не требуется изменений в структуре базы данных. Благодаря этому очень легко добавлять новые.
* У каждой настройки имеется *значение по умолчанию*, что заметно упрощает управление конфигурациями.

Новые динамические настройки распределены по двум вкладкам на странице редактирования свойств домена: {{< fl "General" >}} и {{< fl "Authentication" >}}:

{{< imgfig "https://res.cloudinary.com/yktoo/image/upload/v1713629173/blog/kor2lb4sxxvbekcekntp.png" "Вкладка «General»  на странице редактирования домена." "border shadow" >}}

{{< imgfig "https://res.cloudinary.com/yktoo/image/upload/v1713629278/blog/elyblqaumpaxa7f5fjjn.png" "Вкладка «Authentication»  на странице редактирования домена." "border shadow" >}}

С большей частью из них вы уже знакомы, так как они и ранее присутствовали в глобальной (системной) динамической конфигурации. В новой версии системные параметры лишь задают установки по умолчанию при регистрации нового домена:

{{< imgfig "https://res.cloudinary.com/yktoo/image/upload/v1713629474/blog/amogxh5dveu5cjybqtif.png" "Динамическая конфигурация системы." "border shadow" >}}

Настройки, отмеченные звёздочкой (`*`) на скриншоте выше, как раз и являются теми, которые задают исходные значения при создании нового домена.

### Незарегистрированные комментаторы с именем

Возможность комментировать без регистрации присутствовала в {{< fl "Comentario" >}} и раньше, но пользователь при этом всегда оставался анонимным ({{< fl "Anonymous" >}}). Сейчас соответствующая настройка называется {{< fl "Commenting without registration" >}} («Комментирование без регистрации ~~и смс~~» на скриншоте {{< fl "Authentication" >}} выше), и при её активации у пользователей появляется возможность указать своё имя. Делается это в диалоге логина в специальном поле, когда выбирается комментирование без регистрации:

{{< imgfig "https://res.cloudinary.com/yktoo/image/upload/v1713629947/blog/lmxtlnlpcq46vqgvxmp5.png" "Диалог логина с полем имени комментатора." >}}

### Емэйл-уведомления об утверждённых и отклонённых комментариях

У каждого пользователя появилась новая настройка, позволяющая включить уведомления об изменении статуса его комментов и задаваемая отдельно для каждого домена:

{{< imgfig "https://res.cloudinary.com/yktoo/image/upload/v1713630437/blog/drd6w5lioqx3xasgvqiu.png" "Настройка уведомления о статусе коммента." >}}

Когда она активирована (значение по умолчанию), пользователь будет получать емэйл-уведомления о каждом комменте, утверждённом ({{< fl "approved" >}}) или отклонённом ({{< fl "rejected" >}}) модератором.

### Улучшенное отображение метаданных коммента

У отредактированных и удалённых комментариев теперь понятнее отображается, кто, что и когда сделал:

{{< imgfig "https://res.cloudinary.com/yktoo/image/upload/v1713630930/blog/vmhzpzmstrsbh0kc1quk.png" "Метаданные коммента." >}}

**Кстати:** если навести мышь на часть текста с обозначением времени (такую как {{< fl "just now" >}}), во всплывающей подсказке появится точное время события.

### Отслеживание неудачных попыток входа

Если пользователь (или кто-то, кто пытается выдать себя за него) указывает неверный пароль при логине, такая попытка входа будет зарегистрирована. А если количество неудачных попыток превысит [заданный порог](https://docs.comentario.app/en/configuration/backend/dynamic/auth.login.local.maxattempts/), соответствующий аккаунт будет заблокирован. Обладатель роли суперпользователя ({{< fl "superuser" >}}) может видеть соответствующие свойства пользователя:

{{< imgfig "https://res.cloudinary.com/yktoo/image/upload/v1713631362/blog/jhsz0dfvepbnqwmdjc69.png" "Новые свойства, относящиеся к аутентификации." "border shadow" >}}

Счётчик неудачных попыток входа сбрасывается в ноль после первого успешного логина.

Как можно заметить на скриншоте выше, {{< fl "Comentario" >}} теперь также регистрирует момент последней смены пароля, благодаря чему в будущем можно будет реализовать политику регулярной смены паролей.

### Список сессий пользователя

Суперпользователи теперь также могут просматривать все сессии конкретного юзера, а также принудительно прекращать их:

{{< imgfig "https://res.cloudinary.com/yktoo/image/upload/v1713631917/blog/q4kxokyszndbwwmxzbfb.png" "Список сессий пользователя." "border shadow" >}}

### Сообщение о заблокированном окне

Для входа через {{< fl "SSO" >}} и соцсети (например, {{< fl "Facebook" >}} или {{< fl "Google" >}}), {{< fl "Comentario" >}} открывает всплывающее окно с соответствующим сайтом внутри. Как недавно выяснилось, {{< fl "Safari" >}} и {{< fl "Firefox" >}} по умолчанию блокируют открытие такого окна; в новой версии было добавлено всплывающее уведомление, объясняющее пользователю, что произошло и что ему нужно сделать:

{{< imgfig "https://res.cloudinary.com/yktoo/image/upload/v1713632115/blog/xmgz4evckqorvdmjvjai.png" "Уведомление о заблокированном попапе." >}}

### Прочие изменения

* Поддержка адресов {{< fl "IPv6" >}} ([#69](https://gitlab.com/comentario/comentario/-/issues/69)), а также более надежная обработка {{< fl "IP" >}}-адресов ([#76](https://gitlab.com/comentario/comentario/-/issues/76))
* Встраиваемая часть: добавлен атрибут [auto-non-interactive-sso](https://docs.comentario.app/en/configuration/embedding/comments-tag/auto-non-interactive-sso/) тега `<comentario-comments>` ([#81](https://gitlab.com/comentario/comentario/-/issues/81))
* Встраиваемая часть: оптимизирована загрузка {{< fl "Comentario" >}} благодаря уменьшению количества необходимых {{< fl "API" >}}-запросов
* Исправлена ситуация с регистрацией полного {{< fl "IP" >}}-адреса при просмотре страницы ([#77](https://gitlab.com/comentario/comentario/-/issues/77))

## Демо-версия

Увидеть новую версию в действии, а также её административный интерфейс (логин с емэйлом `admin@admin` и паролем `admin`), можно на демо-сайте:

{{< button "https://demo.comentario.app/" "Демо-сайт комментариев" "btn-primary mb-3" >}}
{{< button "https://edge.comentario.app/" "Демо админки Comentario" "btn-primary mb-3" >}}

## Установка

Если вы хотите установить {{< fl "Comentario" >}}, вот ссылки на документацию:

* [Getting started](https://docs.comentario.app/en/getting-started/).
* [Installation](https://docs.comentario.app/en/installation/).
* [Migration](https://docs.comentario.app/en/installation/migration/).

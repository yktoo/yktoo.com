---
type: post
date: "2025-06-06T15:57:42+02:00"
title: "3.14.0 Hamiltonsbawn"
tags:
    - Comentario
    - веб
    - софт
    - разработка
    - релиз
    - Go
    - Angular
image: "https://res.cloudinary.com/yktoo/image/upload/v1749218114/blog/fdmhb3ik2m3ifpxt3mto.jpg"
imageCredit: "Изображение: кибермозг."
series: comentario
software: comentario
---

Снова время для новой версии **Comentario**! Выпущен релиз [**3.14.0 Hamiltonsbawn**](https://gitlab.com/comentario/comentario/-/releases/v3.14.0).

[Comentario](/software/comentario) — это быстрый и мощный свободный сервер комментариев для веб-страниц, написанный на {{< fl "Go" >}}.

{{< imgfig "https://res.cloudinary.com/yktoo/image/upload/v1749218114/blog/fdmhb3ik2m3ifpxt3mto.jpg" "Изображение: кибермозг." >}}

> <i class="fas fa-info-circle"></i> Вы можете подписаться на новости {{< fl "Comentario" >}} в [соответствующем блоге](/series/comentario) или через {{< rss-permalink "/series/comentario" "RSS" >}}.

## Что нового

<!--more-->

В новой версии много внутренних изменений, проведена большая работа по рефакторингу и оптимизации кода.

### Поддержка БД-транзакций

Вплоть до сегодняшнего дня {{< fl "Comentario" >}} выполнял все операции с базой данных «в лоб», не используя транзакций — так называемый *технический долг* ({{< fl "technical debt" >}}), ведущий свою историю с предшественника {{< fl "Commento" >}}.

Начиная с версии **3.14.0** каждая логическая операция выполняется в контексте отдельной транзакции. Это значит, что вся операция либо целиком подтверждается («коммитится»), либо, в случае ошибки, целиком откатывается обратно. Такой подход гарантирует целостность и непротиворечивость информации, хранимой в базе данных.

### Страницы домена

Функционал страниц доменов был заметно улучшен.

#### Редактируемое заглавие

Отныне заглавие ({{< fl "title" >}}) любой страницы можно отредактировать. Это может помочь навести порядок в списке ваших страниц, особенно в ситуациях, когда заглавие нельзя извлечь автоматически — например, в одностраничных {{< fl "Angular" >}}- или {{< fl "React" >}}-приложениях.

#### Удаление страниц

Еще одна очевидная функция, которой не хватало, — это удаление страницы. Например, если соответствующая страница сайта больше не существует или вы хотите оптом удалить все комментарии по определённому адресу.

Страницы доменов создаются {{< fl "Comentario" >}} автоматически, когда кто-нибудь запрашивает новый, ещё не существующий адрес, и используются для группировки *комментариев* и регистрации *посещений* соответствующей страницы сайта.

#### Перемещение данных

С течением времени адреса страниц сайтов неизбежно меняются — это реальность, данная нам в ощущениях (и результатах поиска «Гуглом»). Это создаёт проблему, поскольку смена адреса ({{< fl "URL" >}}) страницы фактически приводит к удалению всех комментариев, написанных на ней, — точнее, все комментарии остаются по старому адресу.

Новая функция *перемещения данных страницы* — {{< fl "Move data" >}} — позволяет перенести все комментарии и статистику посещений с одной страницы на другую:

{{< imgfig "https://res.cloudinary.com/yktoo/image/upload/v1749220802/blog/qlrtklvol4rtvhb0vfyr.png" "Страница перемещения данных." "border shadow" >}}

После того, как все данные перенесены, оригинальная страница автоматически удаляется, а комментарии продолжают жить по новому адресу.

### Сохранение порядка сортировки

Сортировка в списках {{< fl "Comentario" >}} теперь запоминается и восстанавливается при последующем их посещении. Кроме того, выбранный порядок сортировки отныне отображается на кнопке сортировки — вместо безликого {{< fl "Sort" >}}.

{{< imgfig "https://res.cloudinary.com/yktoo/image/upload/v1749221788/blog/h4ox7mcogyphvyhksrxd.png" "Новая кнопка сортировки." "border shadow" >}}

### Прочие изменения

* Добавлена опция командной строки `--stats-max-days` и соответствующий параметр статической конфигурации ([#178](https://gitlab.com/comentario/comentario/-/issues/178))
* Импорт данных: реальные емэйлы импортируемых пользователей сразу помечаются как *подтверждённые*
* Добавлена настройка домена {{< fl "Show login dialog for unauthenticated users" >}} ([#154](https://gitlab.com/comentario/comentario/-/issues/154))
* Админка: свойства пользователя: кнопка разблокирования пользователя поставлена а ряд с остальными кнопками
* Админка: свойства пользователя: добавлено количество доменов, которыми владеет пользователь 
* Админка: добавлено отображение количества доменов в списках пользователей и пользователей домена
* Админка: исправлено вертикальное выравнивание аватаров
* Админка: выполнена миграция на {{< fl "Angular signals" >}}
* Бэкенд: автокоррекция количества комментов в БД
* Бэкенд: добавлен доверенный домен в механизм {{< fl "XSRF" >}}-защиты ([CVE-2025-24358](https://nvd.nist.gov/vuln/detail/CVE-2025-24358), `gorilla/csrf` 1.7.3)
* Бэкенд: исправлено сообщение об ошибке не-{{< fl "SSO" >}}-пользователя о необходимости авторизации через {{< fl "SSO" >}} ([#161](https://gitlab.com/comentario/comentario/-/issues/161))
* Бэкенд: исправлено предупреждение `superfluous response.WriteHeader call` в `webSocketsHandler`
* Бэкенд: {{< fl "HTTP" >}}-коды, отличные от `2xx`, не приводят к обновлению заглавия страницы
* Бэкенд: добавлены параметры {{< fl "SSL" >}}-сертификата {{< fl "PostgreSQL" >}} ([#170](https://gitlab.com/comentario/comentario/-/issues/170)) 
* Бэкенд: унификация протоколирования
* Бэкенд: процесс фоновой очистки БД будет повторять попытки в течение неограниченного времени в случае ошибки
* Бэкенд: {{< fl "PL/pgSQL" >}} использует `ELSIF`, а не `ELSEIF`
* Документация: добавлено уведомление о багтрекере
* Обновление {{< fl "Go" >}} до 1.24.3, а также прочих зависимостей ([#172](https://gitlab.com/comentario/comentario/-/issues/172))
* Усовершенствования в подсистеме плагинов
* {{< fl "CI" >}}: обновление конфигурации {{< fl "Netlify" >}}
* {{< fl "CI" >}}: обновление до {{< fl "Kubernetes" >}} 1.31
* Добавлен перевод на немецкий

{{< include-file "/blog/_snippets/_comentario-footer.ru.md" >}}
